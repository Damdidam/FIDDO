<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>FIDDO ‚Äî Vos informations</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f5f5; color: #333; min-height: 100vh; display: flex; flex-direction: column; }

    .header { background: #1F2937; color: white; padding: 1rem; text-align: center; }
    .header h1 { font-size: 1.3rem; color: #0891B2; }
    .header p { font-size: 0.85rem; opacity: 0.7; margin-top: 0.25rem; }

    .lang-bar { display: flex; justify-content: center; gap: 0.5rem; padding: 0.75rem; background: white; border-bottom: 1px solid #ddd; flex-wrap: wrap; }
    .lang-btn { padding: 4px 10px; border: 2px solid #ddd; border-radius: 20px; background: white; font-size: 0.8rem; cursor: pointer; transition: all 0.2s; }
    .lang-btn.active { border-color: #0891B2; background: #ECFEFF; color: #0891B2; font-weight: 600; }

    .main { flex: 1; display: flex; align-items: center; justify-content: center; padding: 1.5rem; }
    .form-card { background: white; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); padding: 2rem; width: 100%; max-width: 420px; }

    .form-title { font-size: 1.2rem; font-weight: 700; text-align: center; margin-bottom: 0.25rem; }
    .form-subtitle { font-size: 0.85rem; color: #666; text-align: center; margin-bottom: 1.5rem; }

    .field { margin-bottom: 1.25rem; }
    .field label { display: block; font-weight: 600; font-size: 0.9rem; margin-bottom: 0.3rem; }
    .field .optional { font-weight: 400; color: #999; font-size: 0.8rem; }
    .field input {
      width: 100%; padding: 12px 14px; border: 2px solid #ddd; border-radius: 8px;
      font-size: 1rem; transition: border-color 0.2s; -webkit-appearance: none;
    }
    .field input:focus { outline: none; border-color: #0891B2; }
    .field .hint { font-size: 0.78rem; color: #999; margin-top: 0.25rem; }

    .or-divider { text-align: center; color: #999; font-size: 0.8rem; margin: -0.5rem 0 1rem; position: relative; }
    .or-divider::before, .or-divider::after { content: ''; position: absolute; top: 50%; width: 35%; height: 1px; background: #ddd; }
    .or-divider::before { left: 0; }
    .or-divider::after { right: 0; }

    .submit-btn {
      width: 100%; padding: 14px; background: #0891B2; color: white; border: none;
      border-radius: 8px; font-size: 1.05rem; font-weight: 700; cursor: pointer;
      transition: background 0.2s; -webkit-appearance: none;
    }
    .submit-btn:hover { background: #0E7490; }
    .submit-btn:disabled { opacity: 0.6; cursor: not-allowed; }

    .error-msg { background: #FFEBEE; color: #C62828; padding: 0.6rem; border-radius: 6px; font-size: 0.85rem; margin-bottom: 1rem; text-align: center; display: none; }

    /* Success screen */
    .success-screen { display: none; text-align: center; }
    .success-screen .check { font-size: 4rem; margin-bottom: 0.5rem; }
    .success-screen h2 { color: #10B981; font-size: 1.3rem; margin-bottom: 0.5rem; }
    .success-screen p { color: #666; font-size: 0.9rem; }

    /* Expired / invalid */
    .expired-screen { display: none; text-align: center; padding: 2rem; }
    .expired-screen .icon { font-size: 3rem; margin-bottom: 0.5rem; }
    .expired-screen h2 { color: #EF4444; margin-bottom: 0.5rem; }
    .expired-screen p { color: #666; font-size: 0.9rem; }
  </style>
</head>
<body>

  <div class="header">
    <h1>FIDDO üêï</h1>
    <p id="header-sub">Programme de fid√©lit√©</p>
  </div>

  <div class="lang-bar">
    <button class="lang-btn active" onclick="setLang('fr')">üá´üá∑ FR</button>
    <button class="lang-btn" onclick="setLang('en')">üá¨üáß EN</button>
    <button class="lang-btn" onclick="setLang('nl')">üá≥üá± NL</button>
    <button class="lang-btn" onclick="setLang('tr')">üáπüá∑ TR</button>
    <button class="lang-btn" onclick="setLang('zh')">üá®üá≥ ‰∏≠Êñá</button>
    <button class="lang-btn" onclick="setLang('ar')">üá∏üá¶ ÿπÿ±ÿ®Ÿä</button>
  </div>

  <div class="main">
    <div class="form-card">

      <!-- Form -->
      <div id="form-screen">
        <div class="form-title" data-i18n="title">Vos informations</div>
        <div class="form-subtitle" data-i18n="subtitle">Remplissez pour recevoir vos points de fid√©lit√©</div>

        <div class="error-msg" id="error-msg"></div>

        <form id="client-form" autocomplete="off">
          <div class="field">
            <label data-i18n="label_email">Email</label>
            <input type="email" id="cf-email" placeholder="votre@email.com" inputmode="email" autocomplete="email">
          </div>

          <div class="or-divider" data-i18n="or">ou</div>

          <div class="field">
            <label data-i18n="label_phone">T√©l√©phone</label>
            <input type="tel" id="cf-phone" placeholder="+32 497 12 34 56" inputmode="tel" autocomplete="tel">
            <div class="hint" data-i18n="phone_hint">Avec indicatif pays (+32, +33‚Ä¶)</div>
          </div>

          <div class="field">
            <label data-i18n="label_name">Pr√©nom / Nom <span class="optional" data-i18n="optional">(optionnel)</span></label>
            <input type="text" id="cf-name" placeholder="Pierre" autocomplete="given-name">
          </div>

          <button type="submit" class="submit-btn" id="submit-btn" data-i18n="submit">Envoyer ‚úì</button>
        </form>
      </div>

      <!-- Success -->
      <div id="success-screen" class="success-screen">
        <div class="check">‚úÖ</div>
        <h2 data-i18n="success_title">Merci !</h2>
        <p data-i18n="success_msg">Vos informations ont √©t√© transmises. Vous pouvez fermer cette page.</p>
      </div>

      <!-- Expired -->
      <div id="expired-screen" class="expired-screen">
        <div class="icon">‚è∞</div>
        <h2 data-i18n="expired_title">Session expir√©e</h2>
        <p data-i18n="expired_msg">Ce QR code n'est plus valide. Demandez un nouveau code au restaurant.</p>
      </div>

    </div>
  </div>

  <script>
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // i18n
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    const translations = {
      fr: {
        title: 'Vos informations',
        subtitle: 'Remplissez pour recevoir vos points de fid√©lit√©',
        label_email: 'Email',
        label_phone: 'T√©l√©phone',
        label_name: 'Pr√©nom / Nom',
        optional: '(optionnel)',
        or: 'ou',
        phone_hint: 'Avec indicatif pays (+32, +33‚Ä¶)',
        submit: 'Envoyer ‚úì',
        success_title: 'Merci !',
        success_msg: 'Vos informations ont √©t√© transmises. Vous pouvez fermer cette page.',
        expired_title: 'Session expir√©e',
        expired_msg: 'Ce QR code n\'est plus valide. Demandez un nouveau code au restaurant.',
        error_required: 'Email ou t√©l√©phone requis',
        header_sub: 'Programme de fid√©lit√©',
      },
      en: {
        title: 'Your information',
        subtitle: 'Fill in to receive your loyalty points',
        label_email: 'Email',
        label_phone: 'Phone',
        label_name: 'First name / Name',
        optional: '(optional)',
        or: 'or',
        phone_hint: 'With country code (+32, +33‚Ä¶)',
        submit: 'Send ‚úì',
        success_title: 'Thank you!',
        success_msg: 'Your information has been sent. You can close this page.',
        expired_title: 'Session expired',
        expired_msg: 'This QR code is no longer valid. Ask for a new one at the restaurant.',
        error_required: 'Email or phone required',
        header_sub: 'Loyalty program',
      },
      nl: {
        title: 'Uw gegevens',
        subtitle: 'Vul in om uw getrouwheidspunten te ontvangen',
        label_email: 'E-mail',
        label_phone: 'Telefoon',
        label_name: 'Voornaam / Naam',
        optional: '(optioneel)',
        or: 'of',
        phone_hint: 'Met landcode (+32, +33‚Ä¶)',
        submit: 'Verzenden ‚úì',
        success_title: 'Bedankt!',
        success_msg: 'Uw gegevens zijn verzonden. U kunt deze pagina sluiten.',
        expired_title: 'Sessie verlopen',
        expired_msg: 'Deze QR-code is niet meer geldig. Vraag een nieuwe aan het restaurant.',
        error_required: 'E-mail of telefoon vereist',
        header_sub: 'Getrouwheidsprogramma',
      },
      tr: {
        title: 'Bilgileriniz',
        subtitle: 'Sadakat puanlarƒ±nƒ±zƒ± almak i√ßin doldurun',
        label_email: 'E-posta',
        label_phone: 'Telefon',
        label_name: 'Ad / Soyad',
        optional: '(isteƒüe baƒülƒ±)',
        or: 'veya',
        phone_hint: '√úlke kodu ile (+32, +33‚Ä¶)',
        submit: 'G√∂nder ‚úì',
        success_title: 'Te≈üekk√ºrler!',
        success_msg: 'Bilgileriniz iletildi. Bu sayfayƒ± kapatabilirsiniz.',
        expired_title: 'Oturum s√ºresi doldu',
        expired_msg: 'Bu QR kod artƒ±k ge√ßerli deƒüil. Restorandan yeni bir kod isteyin.',
        error_required: 'E-posta veya telefon gerekli',
        header_sub: 'Sadakat programƒ±',
      },
      zh: {
        title: 'ÊÇ®ÁöÑ‰ø°ÊÅØ',
        subtitle: 'Â°´ÂÜô‰ª•Ëé∑ÂæóÊÇ®ÁöÑÁßØÂàÜ',
        label_email: 'ÁîµÂ≠êÈÇÆÁÆ±',
        label_phone: 'ÁîµËØù',
        label_name: 'ÂßìÂêç',
        optional: 'ÔºàÂèØÈÄâÔºâ',
        or: 'Êàñ',
        phone_hint: 'ËØ∑Âä†ÂõΩÈôÖÂå∫Âè∑Ôºà+32„ÄÅ+33‚Ä¶Ôºâ',
        submit: 'Êèê‰∫§ ‚úì',
        success_title: 'Ë∞¢Ë∞¢ÔºÅ',
        success_msg: 'ÊÇ®ÁöÑ‰ø°ÊÅØÂ∑≤ÂèëÈÄÅÔºåÊÇ®ÂèØ‰ª•ÂÖ≥Èó≠Ê≠§È°µÈù¢„ÄÇ',
        expired_title: '‰ºöËØùÂ∑≤ËøáÊúü',
        expired_msg: 'Ê≠§‰∫åÁª¥Á†ÅÂ∑≤Â§±ÊïàÔºåËØ∑ÂêëÈ§êÂéÖÁ¥¢Ë¶ÅÊñ∞ÁöÑ‰∫åÁª¥Á†Å„ÄÇ',
        error_required: 'ÈúÄË¶ÅÁîµÂ≠êÈÇÆÁÆ±ÊàñÁîµËØù',
        header_sub: 'ÁßØÂàÜËÆ°Âàí',
      },
      ar: {
        title: 'ŸÖÿπŸÑŸàŸÖÿßÿ™ŸÉ',
        subtitle: 'ÿßŸÖŸÑÿ£ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÑŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÜŸÇÿßÿ∑ ÿßŸÑŸàŸÑÿßÿ°',
        label_email: 'ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä',
        label_phone: 'ÿßŸÑŸáÿßÿ™ŸÅ',
        label_name: 'ÿßŸÑÿßÿ≥ŸÖ',
        optional: '(ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)',
        or: 'ÿ£Ÿà',
        phone_hint: 'ŸÖÿπ ÿ±ŸÖÿ≤ ÿßŸÑÿØŸàŸÑÿ© (+32ÿå +33‚Ä¶)',
        submit: 'ÿ•ÿ±ÿ≥ÿßŸÑ ‚úì',
        success_title: '!ÿ¥ŸÉÿ±ÿßŸã',
        success_msg: '.ÿ™ŸÖ ÿ•ÿ±ÿ≥ÿßŸÑ ŸÖÿπŸÑŸàŸÖÿßÿ™ŸÉ. ŸäŸÖŸÉŸÜŸÉ ÿ•ÿ∫ŸÑÿßŸÇ Ÿáÿ∞Ÿá ÿßŸÑÿµŸÅÿ≠ÿ©',
        expired_title: 'ÿßŸÜÿ™Ÿáÿ™ ÿßŸÑÿ¨ŸÑÿ≥ÿ©',
        expired_msg: '.ÿ±ŸÖÿ≤ QR ŸÑŸÖ ŸäÿπÿØ ÿµÿßŸÑÿ≠ÿßŸã. ÿßÿ∑ŸÑÿ® ÿ±ŸÖÿ≤ÿßŸã ÿ¨ÿØŸäÿØÿßŸã ŸÖŸÜ ÿßŸÑŸÖÿ∑ÿπŸÖ',
        error_required: 'ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä ÿ£Ÿà ÿßŸÑŸáÿßÿ™ŸÅ ŸÖÿ∑ŸÑŸàÿ®',
        header_sub: 'ÿ®ÿ±ŸÜÿßŸÖÿ¨ ÿßŸÑŸàŸÑÿßÿ°',
      },
    };

    let currentLang = 'fr';

    function setLang(lang) {
      currentLang = lang;
      const t = translations[lang] || translations.fr;

      // Update buttons
      document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.classList.toggle('active', btn.textContent.toLowerCase().includes(lang));
      });

      // Update all data-i18n elements
      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (t[key]) el.textContent = t[key];
      });

      // Update header
      document.getElementById('header-sub').textContent = t.header_sub;

      // Update placeholders
      if (lang === 'zh') {
        document.getElementById('cf-email').placeholder = 'your@email.com';
        document.getElementById('cf-phone').placeholder = '+86 138 0000 0000';
        document.getElementById('cf-name').placeholder = 'Âº†‰∏â';
      } else if (lang === 'ar') {
        document.getElementById('cf-email').placeholder = 'your@email.com';
        document.getElementById('cf-phone').placeholder = '+966 50 000 0000';
        document.getElementById('cf-name').placeholder = 'ŸÖÿ≠ŸÖÿØ';
      } else if (lang === 'tr') {
        document.getElementById('cf-email').placeholder = 'email@ornek.com';
        document.getElementById('cf-phone').placeholder = '+90 532 000 0000';
        document.getElementById('cf-name').placeholder = 'Ahmet';
      } else {
        document.getElementById('cf-email').placeholder = 'votre@email.com';
        document.getElementById('cf-phone').placeholder = '+32 497 12 34 56';
        document.getElementById('cf-name').placeholder = 'Pierre';
      }

      // RTL for Arabic
      document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // SESSION TOKEN
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    const params = new URLSearchParams(window.location.search);
    const sessionToken = params.get('s');

    if (!sessionToken) {
      document.getElementById('form-screen').style.display = 'none';
      document.getElementById('expired-screen').style.display = 'block';
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // FORM SUBMIT
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    document.getElementById('client-form').addEventListener('submit', async (e) => {
      e.preventDefault();

      const email = document.getElementById('cf-email').value.trim();
      const phone = document.getElementById('cf-phone').value.trim();
      const name = document.getElementById('cf-name').value.trim();
      const t = translations[currentLang] || translations.fr;

      // Validation
      if (!email && !phone) {
        const errEl = document.getElementById('error-msg');
        errEl.textContent = t.error_required;
        errEl.style.display = 'block';
        return;
      }

      document.getElementById('error-msg').style.display = 'none';
      document.getElementById('submit-btn').disabled = true;

      try {
        const API_BASE = window.location.origin + '/api';
        const resp = await fetch(`${API_BASE}/qr/submit/${sessionToken}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email: email || null, phone: phone || null, name: name || null }),
        });

        const data = await resp.json();

        if (!resp.ok) {
          if (resp.status === 404 || resp.status === 410) {
            // Expired or invalid session
            document.getElementById('form-screen').style.display = 'none';
            document.getElementById('expired-screen').style.display = 'block';
          } else {
            const errEl = document.getElementById('error-msg');
            errEl.textContent = data.error || 'Error';
            errEl.style.display = 'block';
            document.getElementById('submit-btn').disabled = false;
          }
          return;
        }

        // Success!
        document.getElementById('form-screen').style.display = 'none';
        document.getElementById('success-screen').style.display = 'block';

      } catch (err) {
        console.error(err);
        document.getElementById('submit-btn').disabled = false;
        const errEl = document.getElementById('error-msg');
        errEl.textContent = 'Erreur r√©seau / Network error';
        errEl.style.display = 'block';
      }
    });

    // Auto-detect browser language
    (function autoLang() {
      const browserLang = (navigator.language || '').substring(0, 2).toLowerCase();
      if (translations[browserLang]) {
        setLang(browserLang);
      }
    })();
  </script>
</body>
</html>
