<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>FIDDO â€” Vos informations</title>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       CLIENT FORM â€” QR identification page
       Mobile-first, themed per merchant
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --accent: #0891B2;
      --accent-dark: #0E7490;
      --accent-light: #ECFEFF;
      --accent-glow: rgba(8,145,178,0.12);
      --dark: #1F2937;
      --gradient: linear-gradient(135deg, var(--accent), var(--accent-dark));
    }

    /* â”€â”€ Theme overrides â”€â”€ */
    [data-theme="navy"]   { --accent: #1E40AF; --accent-dark: #1E3A8A; --accent-light: #DBEAFE; --accent-glow: rgba(30,64,175,0.12); --dark: #1E293B; }
    [data-theme="violet"] { --accent: #7C3AED; --accent-dark: #6D28D9; --accent-light: #EDE9FE; --accent-glow: rgba(124,58,237,0.12); --dark: #1E1B4B; }
    [data-theme="forest"] { --accent: #059669; --accent-dark: #047857; --accent-light: #D1FAE5; --accent-glow: rgba(5,150,105,0.12); --dark: #1A2E1A; }
    [data-theme="brick"]  { --accent: #DC2626; --accent-dark: #B91C1C; --accent-light: #FEE2E2; --accent-glow: rgba(220,38,38,0.12); --dark: #2D1B1B; }
    [data-theme="amber"]  { --accent: #D97706; --accent-dark: #B45309; --accent-light: #FEF3C7; --accent-glow: rgba(217,119,6,0.12); --dark: #2D2415; }
    [data-theme="slate"]  { --accent: #475569; --accent-dark: #334155; --accent-light: #F1F5F9; --accent-glow: rgba(71,85,105,0.12); --dark: #0F172A; }

    body {
      font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #F1F5F9;
      color: #1E293B;
      min-height: 100vh;
      min-height: 100dvh;
      display: flex;
      flex-direction: column;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       HEADER â€” gradient band
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

    .hdr {
      background: var(--gradient);
      color: white;
      padding: 1.1rem 1rem 0.9rem;
      text-align: center;
      position: relative;
      overflow: hidden;
    }
    .hdr::after {
      content: '';
      position: absolute;
      bottom: -1px; left: 0; right: 0;
      height: 20px;
      background: #F1F5F9;
      border-radius: 20px 20px 0 0;
    }
    .hdr-brand {
      font-size: 0.72rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      opacity: 0.75;
    }
    .hdr-merchant {
      font-size: 1.4rem;
      font-weight: 700;
      margin-top: 0.2rem;
      letter-spacing: -0.4px;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       LANG SELECTOR â€” compact pills
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

    .lang-bar {
      display: flex;
      justify-content: center;
      gap: 0.35rem;
      padding: 0.5rem 0.75rem;
      flex-wrap: wrap;
    }
    .lang-btn {
      padding: 3px 9px;
      border: 1.5px solid #E2E8F0;
      border-radius: 14px;
      background: white;
      font-family: inherit;
      font-size: 0.72rem;
      font-weight: 500;
      color: #64748B;
      cursor: pointer;
      transition: all 0.15s;
    }
    .lang-btn.active {
      border-color: var(--accent);
      background: var(--accent-light);
      color: var(--accent-dark);
      font-weight: 600;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MAIN CARD
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

    .main {
      flex: 1;
      display: flex;
      align-items: flex-start;
      justify-content: center;
      padding: 0.5rem 1rem 2rem;
    }
    .card {
      background: white;
      border-radius: 14px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.06);
      padding: 1.5rem;
      width: 100%;
      max-width: 400px;
    }

    .card-title {
      font-size: 1.1rem;
      font-weight: 700;
      text-align: center;
      color: #1E293B;
      letter-spacing: -0.3px;
    }
    .card-sub {
      font-size: 0.8rem;
      color: #64748B;
      text-align: center;
      margin-top: 0.2rem;
      margin-bottom: 1.25rem;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       FORM FIELDS
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

    .field { margin-bottom: 1rem; }
    .field label {
      display: block;
      font-weight: 600;
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.3px;
      color: #475569;
      margin-bottom: 0.3rem;
    }
    .field .opt {
      font-weight: 400;
      text-transform: none;
      letter-spacing: 0;
      color: #94A3B8;
      font-size: 0.72rem;
    }
    .field input {
      width: 100%;
      padding: 0.6rem 0.75rem;
      border: 1.5px solid #E2E8F0;
      border-radius: 8px;
      font-family: inherit;
      font-size: 0.95rem;
      color: #1E293B;
      background: #FAFBFC;
      -webkit-appearance: none;
      transition: border-color 0.15s, box-shadow 0.15s;
    }
    .field input:focus {
      outline: none;
      border-color: var(--accent);
      background: white;
      box-shadow: 0 0 0 3px var(--accent-glow);
    }
    .field input::placeholder { color: #94A3B8; }
    .field .hint {
      font-size: 0.68rem;
      color: #94A3B8;
      margin-top: 0.2rem;
    }

    /* â”€â”€ OR divider â”€â”€ */
    .divider {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin: -0.15rem 0 0.85rem;
      font-size: 0.72rem;
      color: #94A3B8;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .divider::before, .divider::after {
      content: '';
      flex: 1;
      height: 1px;
      background: #E2E8F0;
    }

    /* â”€â”€ Submit â”€â”€ */
    .btn-submit {
      width: 100%;
      padding: 0.7rem;
      border: none;
      border-radius: 8px;
      background: var(--gradient);
      color: white;
      font-family: inherit;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      -webkit-appearance: none;
      transition: box-shadow 0.15s;
      box-shadow: 0 2px 8px var(--accent-glow);
    }
    .btn-submit:active {
      box-shadow: 0 1px 3px var(--accent-glow);
    }
    .btn-submit:disabled {
      opacity: 0.55;
      cursor: not-allowed;
    }

    /* â”€â”€ Error â”€â”€ */
    .err-msg {
      background: #FEF2F2;
      color: #B91C1C;
      border: 1px solid #FECACA;
      padding: 0.5rem 0.75rem;
      border-radius: 7px;
      font-size: 0.82rem;
      margin-bottom: 0.85rem;
      text-align: center;
      display: none;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SUCCESS SCREEN
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

    .screen-success {
      display: none;
      text-align: center;
      padding: 1rem 0;
    }
    .screen-success .check-ring {
      width: 64px; height: 64px;
      border-radius: 50%;
      background: #D1FAE5;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 0.75rem;
    }
    .screen-success .check-ring svg {
      width: 28px; height: 28px;
      stroke: #059669;
      stroke-width: 2.5;
      fill: none;
    }
    .screen-success h2 {
      font-size: 1.15rem;
      font-weight: 700;
      color: #059669;
      margin-bottom: 0.3rem;
    }
    .screen-success p {
      font-size: 0.82rem;
      color: #64748B;
      line-height: 1.6;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       EXPIRED SCREEN
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

    .screen-expired {
      display: none;
      text-align: center;
      padding: 1rem 0;
    }
    .screen-expired .exp-ring {
      width: 64px; height: 64px;
      border-radius: 50%;
      background: #FEF3C7;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 0.75rem;
      font-size: 1.6rem;
    }
    .screen-expired h2 {
      font-size: 1.15rem;
      font-weight: 700;
      color: #B45309;
      margin-bottom: 0.3rem;
    }
    .screen-expired p {
      font-size: 0.82rem;
      color: #64748B;
      line-height: 1.6;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       FOOTER
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

    .foot {
      text-align: center;
      padding: 0.75rem;
      font-size: 0.65rem;
      color: #94A3B8;
      letter-spacing: 0.3px;
    }
    .foot a { color: var(--accent); text-decoration: none; font-weight: 600; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       RESPONSIVE
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

    @media (min-height: 700px) {
      .main { align-items: center; }
    }

    @media (max-width: 380px) {
      .card { padding: 1.15rem; }
      .lang-btn { font-size: 0.68rem; padding: 2px 7px; }
    }

    /* â”€â”€ RTL â”€â”€ */
    [dir="rtl"] .field input { text-align: right; }
    [dir="rtl"] .hint { text-align: right; }
  </style>
</head>
<body>

  <!-- â•â•â•â•â•â•â•â• HEADER â•â•â•â•â•â•â•â• -->
  <div class="hdr">
    <div class="hdr-brand">FIDDO</div>
    <div class="hdr-merchant" id="merchant-name"></div>
  </div>

  <!-- â•â•â•â•â•â•â•â• LANGUAGE â•â•â•â•â•â•â•â• -->
  <div class="lang-bar">
    <button class="lang-btn active" onclick="setLang('fr')">ğŸ‡«ğŸ‡· FR</button>
    <button class="lang-btn" onclick="setLang('en')">ğŸ‡¬ğŸ‡§ EN</button>
    <button class="lang-btn" onclick="setLang('nl')">ğŸ‡³ğŸ‡± NL</button>
    <button class="lang-btn" onclick="setLang('tr')">ğŸ‡¹ğŸ‡· TR</button>
    <button class="lang-btn" onclick="setLang('zh')">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</button>
    <button class="lang-btn" onclick="setLang('ar')">ğŸ‡¸ğŸ‡¦ Ø¹Ø±Ø¨ÙŠ</button>
  </div>

  <!-- â•â•â•â•â•â•â•â• MAIN â•â•â•â•â•â•â•â• -->
  <div class="main">
    <div class="card">

      <!-- â”€â”€ Form screen â”€â”€ -->
      <div id="form-screen">
        <div class="card-title" data-i18n="title">Vos informations</div>
        <div class="card-sub" data-i18n="subtitle">Remplissez pour recevoir vos points de fidÃ©litÃ©</div>

        <div class="err-msg" id="error-msg"></div>

        <form id="client-form" autocomplete="off">
          <div class="field">
            <label data-i18n="label_email">Email</label>
            <input type="email" id="cf-email" placeholder="votre@email.com" inputmode="email" autocomplete="email">
          </div>

          <div class="divider"><span data-i18n="or">ou</span></div>

          <div class="field">
            <label data-i18n="label_phone">TÃ©lÃ©phone</label>
            <input type="tel" id="cf-phone" placeholder="+32 497 12 34 56" inputmode="tel" autocomplete="tel">
            <div class="hint" data-i18n="phone_hint">Avec indicatif pays (+32, +33â€¦)</div>
          </div>

          <div class="field">
            <label>
              <span data-i18n="label_name">PrÃ©nom / Nom</span>
              <span class="opt" data-i18n="optional">(optionnel)</span>
            </label>
            <input type="text" id="cf-name" placeholder="Pierre" autocomplete="given-name">
          </div>

          <div class="field">
            <label data-i18n="label_pin">Code PIN (4 chiffres)</label>
            <input type="tel" id="cf-pin" placeholder="1234" inputmode="numeric" pattern="\d{4}" maxlength="4" autocomplete="off" style="text-align:center; font-size:1.4rem; letter-spacing:0.5rem; font-weight:700;">
            <div class="hint" data-i18n="pin_hint">Ce code vous sera demandÃ© pour utiliser votre rÃ©compense</div>
          </div>

          <button type="submit" class="btn-submit" id="submit-btn" data-i18n="submit">Envoyer âœ“</button>
        </form>
      </div>

      <!-- â”€â”€ Success screen â”€â”€ -->
      <div id="success-screen" class="screen-success">
        <div class="check-ring">
          <svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
        </div>
        <h2 data-i18n="success_title">Merci !</h2>
        <p data-i18n="success_msg">Vos informations ont Ã©tÃ© transmises. Vous pouvez fermer cette page.</p>
      </div>

      <!-- â”€â”€ Expired screen â”€â”€ -->
      <div id="expired-screen" class="screen-expired">
        <div class="exp-ring">â±</div>
        <h2 data-i18n="expired_title">Session expirÃ©e</h2>
        <p data-i18n="expired_msg">Ce QR code n'est plus valide. Demandez un nouveau code au restaurant.</p>
      </div>

    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â• FOOTER â•â•â•â•â•â•â•â• -->
  <div class="foot">
    PropulsÃ© par <a href="https://fiddo.be">FIDDO</a> Â· Programme de fidÃ©litÃ©
  </div>

  <script>
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // i18n â€” 6 languages
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    const T = {
      fr: {
        title: 'Vos informations',
        subtitle: 'Remplissez pour recevoir vos points de fidÃ©litÃ©',
        label_email: 'Email',
        label_phone: 'TÃ©lÃ©phone',
        label_name: 'PrÃ©nom / Nom',
        optional: '(optionnel)',
        or: 'ou',
        phone_hint: 'Avec indicatif pays (+32, +33â€¦)',
        label_pin: 'Code PIN (4 chiffres)',
        pin_hint: 'Ce code vous sera demandÃ© pour utiliser votre rÃ©compense',
        submit: 'Envoyer âœ“',
        success_title: 'Merci !',
        success_msg: 'Vos informations ont Ã©tÃ© transmises. Vous pouvez fermer cette page.',
        expired_title: 'Session expirÃ©e',
        expired_msg: 'Ce QR code n\'est plus valide. Demandez un nouveau code au restaurant.',
        error_required: 'Email ou tÃ©lÃ©phone requis',
        header_sub: 'Programme de fidÃ©litÃ©',
        ph_email: 'votre@email.com',
        ph_phone: '+32 497 12 34 56',
        ph_name: 'Pierre',
      },
      en: {
        title: 'Your information',
        subtitle: 'Fill in to receive your loyalty points',
        label_email: 'Email',
        label_phone: 'Phone',
        label_name: 'First name / Name',
        optional: '(optional)',
        or: 'or',
        phone_hint: 'With country code (+32, +33â€¦)',
        label_pin: 'PIN code (4 digits)',
        pin_hint: 'This code will be required to claim your reward',
        submit: 'Send âœ“',
        success_title: 'Thank you!',
        success_msg: 'Your information has been sent. You can close this page.',
        expired_title: 'Session expired',
        expired_msg: 'This QR code is no longer valid. Ask for a new one at the restaurant.',
        error_required: 'Email or phone required',
        header_sub: 'Loyalty program',
        ph_email: 'your@email.com',
        ph_phone: '+32 497 12 34 56',
        ph_name: 'John',
      },
      nl: {
        title: 'Uw gegevens',
        subtitle: 'Vul in om uw getrouwheidspunten te ontvangen',
        label_email: 'E-mail',
        label_phone: 'Telefoon',
        label_name: 'Voornaam / Naam',
        optional: '(optioneel)',
        or: 'of',
        phone_hint: 'Met landcode (+32, +33â€¦)',
        label_pin: 'Pincode (4 cijfers)',
        pin_hint: 'Deze code is nodig om uw beloning te gebruiken',
        submit: 'Verzenden âœ“',
        success_title: 'Bedankt!',
        success_msg: 'Uw gegevens zijn verzonden. U kunt deze pagina sluiten.',
        expired_title: 'Sessie verlopen',
        expired_msg: 'Deze QR-code is niet meer geldig. Vraag een nieuwe aan het restaurant.',
        error_required: 'E-mail of telefoon vereist',
        header_sub: 'Getrouwheidsprogramma',
        ph_email: 'uw@email.com',
        ph_phone: '+32 497 12 34 56',
        ph_name: 'Jan',
      },
      tr: {
        title: 'Bilgileriniz',
        subtitle: 'Sadakat puanlarÄ±nÄ±zÄ± almak iÃ§in doldurun',
        label_email: 'E-posta',
        label_phone: 'Telefon',
        label_name: 'Ad / Soyad',
        optional: '(isteÄŸe baÄŸlÄ±)',
        or: 'veya',
        phone_hint: 'Ãœlke kodu ile (+32, +33â€¦)',
        label_pin: 'PIN kodu (4 rakam)',
        pin_hint: 'Ã–dÃ¼lÃ¼nÃ¼zÃ¼ almak iÃ§in bu kod gerekecektir',
        submit: 'GÃ¶nder âœ“',
        success_title: 'TeÅŸekkÃ¼rler!',
        success_msg: 'Bilgileriniz iletildi. Bu sayfayÄ± kapatabilirsiniz.',
        expired_title: 'Oturum sÃ¼resi doldu',
        expired_msg: 'Bu QR kod artÄ±k geÃ§erli deÄŸil. Restorandan yeni bir kod isteyin.',
        error_required: 'E-posta veya telefon gerekli',
        header_sub: 'Sadakat programÄ±',
        ph_email: 'email@ornek.com',
        ph_phone: '+90 532 000 0000',
        ph_name: 'Ahmet',
      },
      zh: {
        title: 'æ‚¨çš„ä¿¡æ¯',
        subtitle: 'å¡«å†™ä»¥è·å¾—æ‚¨çš„ç§¯åˆ†',
        label_email: 'ç”µå­é‚®ç®±',
        label_phone: 'ç”µè¯',
        label_name: 'å§“å',
        optional: 'ï¼ˆå¯é€‰ï¼‰',
        or: 'æˆ–',
        phone_hint: 'è¯·åŠ å›½é™…åŒºå·ï¼ˆ+32ã€+33â€¦ï¼‰',
        label_pin: 'PINç ï¼ˆ4ä½æ•°å­—ï¼‰',
        pin_hint: 'é¢†å–å¥–åŠ±æ—¶éœ€è¦æ­¤å¯†ç ',
        submit: 'æäº¤ âœ“',
        success_title: 'è°¢è°¢ï¼',
        success_msg: 'æ‚¨çš„ä¿¡æ¯å·²å‘é€ï¼Œæ‚¨å¯ä»¥å…³é—­æ­¤é¡µé¢ã€‚',
        expired_title: 'ä¼šè¯å·²è¿‡æœŸ',
        expired_msg: 'æ­¤äºŒç»´ç å·²å¤±æ•ˆï¼Œè¯·å‘é¤å…ç´¢è¦æ–°çš„äºŒç»´ç ã€‚',
        error_required: 'éœ€è¦ç”µå­é‚®ç®±æˆ–ç”µè¯',
        header_sub: 'ç§¯åˆ†è®¡åˆ’',
        ph_email: 'your@email.com',
        ph_phone: '+86 138 0000 0000',
        ph_name: 'å¼ ä¸‰',
      },
      ar: {
        title: 'Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙƒ',
        subtitle: 'Ø§Ù…Ù„Ø£ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù†Ù‚Ø§Ø· Ø§Ù„ÙˆÙ„Ø§Ø¡',
        label_email: 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ',
        label_phone: 'Ø§Ù„Ù‡Ø§ØªÙ',
        label_name: 'Ø§Ù„Ø§Ø³Ù…',
        optional: '(Ø§Ø®ØªÙŠØ§Ø±ÙŠ)',
        or: 'Ø£Ùˆ',
        phone_hint: 'Ù…Ø¹ Ø±Ù…Ø² Ø§Ù„Ø¯ÙˆÙ„Ø© (+32ØŒ +33â€¦)',
        label_pin: 'Ø±Ù…Ø² PIN (4 Ø£Ø±Ù‚Ø§Ù…)',
        pin_hint: 'Ø³ØªØ­ØªØ§Ø¬ Ù‡Ø°Ø§ Ø§Ù„Ø±Ù…Ø² Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…ÙƒØ§ÙØ£ØªÙƒ',
        submit: 'Ø¥Ø±Ø³Ø§Ù„ âœ“',
        success_title: '!Ø´ÙƒØ±Ø§Ù‹',
        success_msg: '.ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙƒ. ÙŠÙ…ÙƒÙ†Ùƒ Ø¥ØºÙ„Ø§Ù‚ Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø©',
        expired_title: 'Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø¬Ù„Ø³Ø©',
        expired_msg: '.Ø±Ù…Ø² QR Ù„Ù… ÙŠØ¹Ø¯ ØµØ§Ù„Ø­Ø§Ù‹. Ø§Ø·Ù„Ø¨ Ø±Ù…Ø²Ø§Ù‹ Ø¬Ø¯ÙŠØ¯Ø§Ù‹ Ù…Ù† Ø§Ù„Ù…Ø·Ø¹Ù…',
        error_required: 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø£Ùˆ Ø§Ù„Ù‡Ø§ØªÙ Ù…Ø·Ù„ÙˆØ¨',
        header_sub: 'Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„ÙˆÙ„Ø§Ø¡',
        ph_email: 'your@email.com',
        ph_phone: '+966 50 000 0000',
        ph_name: 'Ù…Ø­Ù…Ø¯',
      },
    };

    let currentLang = 'fr';

    function setLang(lang) {
      currentLang = lang;
      const t = T[lang] || T.fr;

      // Active pill
      document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.classList.toggle('active', btn.textContent.toLowerCase().includes(lang));
      });

      // i18n text
      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (t[key]) el.textContent = t[key];
      });

      // Placeholders
      document.getElementById('cf-email').placeholder = t.ph_email || 'votre@email.com';
      document.getElementById('cf-phone').placeholder = t.ph_phone || '+32 497 12 34 56';
      document.getElementById('cf-name').placeholder = t.ph_name || 'Pierre';

      // RTL
      document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
    }


    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // SESSION TOKEN
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    const params = new URLSearchParams(window.location.search);
    const sessionToken = params.get('s');

    if (!sessionToken) {
      document.getElementById('form-screen').style.display = 'none';
      document.getElementById('expired-screen').style.display = 'block';
    }


    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // LOAD MERCHANT INFO (name + theme)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    if (sessionToken) {
      (async function loadInfo() {
        try {
          const API_BASE = window.location.origin + '/api';
          const resp = await fetch(API_BASE + '/qr/info/' + sessionToken);

          if (resp.status === 404 || resp.status === 410) {
            document.getElementById('form-screen').style.display = 'none';
            document.getElementById('expired-screen').style.display = 'block';
            return;
          }

          if (resp.ok) {
            const info = await resp.json();

            if (info.merchantName) {
              document.getElementById('merchant-name').textContent = info.merchantName;
              document.title = info.merchantName + ' â€” FIDDO';
            }

            if (info.theme && info.theme !== 'teal') {
              document.documentElement.setAttribute('data-theme', info.theme);
            }
          }
        } catch (e) {
          console.error('Failed to load merchant info:', e);
        }
      })();
    }


    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // FORM SUBMIT
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    document.getElementById('client-form').addEventListener('submit', async (e) => {
      e.preventDefault();

      const email = document.getElementById('cf-email').value.trim();
      const phone = document.getElementById('cf-phone').value.trim();
      const name = document.getElementById('cf-name').value.trim();
      const pin = document.getElementById('cf-pin').value.trim();
      const t = T[currentLang] || T.fr;

      if (!email && !phone) {
        const el = document.getElementById('error-msg');
        el.textContent = t.error_required;
        el.style.display = 'block';
        return;
      }

      // Validate PIN format if provided
      if (pin && !/^\d{4}$/.test(pin)) {
        const el = document.getElementById('error-msg');
        el.textContent = t.error_pin || 'PIN: 4 chiffres requis';
        el.style.display = 'block';
        return;
      }

      document.getElementById('error-msg').style.display = 'none';
      document.getElementById('submit-btn').disabled = true;

      try {
        const API_BASE = window.location.origin + '/api';
        const resp = await fetch(API_BASE + '/qr/submit/' + sessionToken, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            email: email || null,
            phone: phone || null,
            name: name || null,
            pin: pin || null,
          }),
        });

        const data = await resp.json();

        if (!resp.ok) {
          if (resp.status === 404 || resp.status === 410) {
            document.getElementById('form-screen').style.display = 'none';
            document.getElementById('expired-screen').style.display = 'block';
          } else {
            const el = document.getElementById('error-msg');
            el.textContent = data.error || 'Error';
            el.style.display = 'block';
            document.getElementById('submit-btn').disabled = false;
          }
          return;
        }

        // Success
        document.getElementById('form-screen').style.display = 'none';
        document.getElementById('success-screen').style.display = 'block';

      } catch (err) {
        console.error(err);
        document.getElementById('submit-btn').disabled = false;
        const el = document.getElementById('error-msg');
        el.textContent = 'Erreur rÃ©seau / Network error';
        el.style.display = 'block';
      }
    });


    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // AUTO-DETECT LANGUAGE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    (function autoLang() {
      const bl = (navigator.language || '').substring(0, 2).toLowerCase();
      if (T[bl]) setLang(bl);
    })();
  </script>
</body>
</html>
